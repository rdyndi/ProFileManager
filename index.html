<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ProFile Manager</title>

    <!-- TAILWIND -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- FONT -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- TAILWIND CONFIG -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ["Inter", "sans-serif"],
            },
            colors: {
              primary: {
                50: "#eff6ff",
                100: "#dbeafe",
                500: "#3b82f6",
                600: "#2563eb",
                700: "#1d4ed8",
                800: "#1e40af",
                900: "#1e3a8a",
              },
            },
          },
        },
      };
    </script>

    <!-- PRINT STYLE -->
    <style>
      @media print {
        .no-print {
          display: none !important;
        }
        .print-only {
          display: block !important;
        }
        body {
          background: white;
        }
        @page {
          margin: 16mm;
        }
      }
      .print-only {
        display: none;
      }
    </style>

    <!-- IMPORT MAP UNTUK REACT & FIREBASE -->
    <script type="importmap">
      {
        "imports": {
          "react": "https://aistudiocdn.com/react@^19.2.0",
          "react-dom/client": "https://aistudiocdn.com/react-dom@^19.2.0/client",
          "firebase/app": "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js",
          "firebase/firestore": "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"
        }
      }
    </script>
  </head>

  <body class="bg-slate-50 text-slate-900 antialiased font-sans">
    <div id="root"></div>

    <script type="module">
      import React from "react";
      import { createRoot } from "react-dom/client";
      import { initializeApp } from "firebase/app";
      import {
        getFirestore,
        collection,
        addDoc,
        getDocs,
        updateDoc,
        deleteDoc,
        doc,
        serverTimestamp,
        query,
        orderBy
      } from "firebase/firestore";

      // CONFIG FIREBASE KAMU
      const firebaseConfig = {
        apiKey: "AIzaSyClChxcL4T1Rc3b8l6Zobbj6ynAQLWPGwY",
        authDomain: "dompetpintar-d50e0.firebaseapp.com",
        projectId: "dompetpintar-d50e0",
        storageBucket: "dompetpintar-d50e0.firebasestorage.app",
        messagingSenderId: "804793025772",
        appId: "1:804793025772:web:eb3ecc3f4edd030b86d1c9",
        measurementId: "G-3BV80BW6ZN"
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const clientsCol = collection(db, "clients");

      function App() {
        const [clients, setClients] = React.useState([]);
        const [loading, setLoading] = React.useState(true);
        const [saving, setSaving] = React.useState(false);
        const [deletingId, setDeletingId] = React.useState(null);

        const [nama, setNama] = React.useState("");
        const [tipe, setTipe] = React.useState("PT");
        const [kontak, setKontak] = React.useState("");
        const [catatan, setCatatan] = React.useState("");

        const [filter, setFilter] = React.useState("");
        const [editingId, setEditingId] = React.useState(null);

        const [selectedClient, setSelectedClient] = React.useState(null);
        const [printType, setPrintType] = React.useState(null); // "tanda" | "surat" | null

        const [error, setError] = React.useState("");
        const [success, setSuccess] = React.useState("");

        async function loadClients() {
          setLoading(true);
          setError("");
          try {
            const q = query(clientsCol, orderBy("createdAt", "desc"));
            const snap = await getDocs(q);
            const data = [];
            snap.forEach((d) => {
              data.push({ id: d.id, ...d.data() });
            });
            setClients(data);
          } catch (err) {
            console.error("getDocs error:", err);
            setError(
              "Gagal ambil data klien: " +
                (err.code || err.message || "cek Firestore rules & koneksi.")
            );
          }
          setLoading(false);
        }

        React.useEffect(() => {
          loadClients();
        }, []);

        function resetForm() {
          setNama("");
          setTipe("PT");
          setKontak("");
          setCatatan("");
          setEditingId(null);
        }

        async function handleSubmit(e) {
          e.preventDefault();
          setError("");
          setSuccess("");

          if (!nama.trim()) {
            setError("Nama klien wajib diisi.");
            return;
          }

          setSaving(true);
          try {
            if (editingId) {
              const ref = doc(db, "clients", editingId);
              await updateDoc(ref, {
                nama,
                tipe,
                kontak,
                catatan
              });
              setSuccess("Data klien berhasil diperbarui âœ…");
            } else {
              await addDoc(clientsCol, {
                nama,
                tipe,
                kontak,
                catatan,
                createdAt: serverTimestamp()
              });
              setSuccess("Data klien berhasil disimpan âœ…");
            }

            resetForm();
            await loadClients();
          } catch (err) {
            console.error("save error:", err);
            setError(
              "Gagal menyimpan data klien: " +
                (err.code || err.message || "")
            );
          }
          setSaving(false);
        }

        function handleEdit(client) {
          setEditingId(client.id);
          setNama(client.nama || "");
          setTipe(client.tipe || "PT");
          setKontak(client.kontak || "");
          setCatatan(client.catatan || "");
          setSelectedClient(client);
          setSuccess("");
          setError("");
        }

        async function handleDelete(id) {
          setError("");
          setSuccess("");
          const yakin = confirm("Yakin hapus data klien ini?");
          if (!yakin) return;

          setDeletingId(id);
          try {
            const ref = doc(db, "clients", id);
            await deleteDoc(ref);
            setSuccess("Data klien berhasil dihapus ðŸ—‘ï¸");
            await loadClients();
          } catch (err) {
            console.error("delete error:", err);
            setError(
              "Gagal menghapus data klien: " +
                (err.code || err.message || "")
            );
          }
          setDeletingId(null);
        }

        function handlePrint(type, client) {
          setSelectedClient(client);
          setPrintType(type);
          setTimeout(() => {
            window.print();
            setTimeout(() => setPrintType(null), 500);
          }, 100);
        }

        const filteredClients = clients.filter((c) => {
          if (!filter.trim()) return true;
          const text =
            (c.nama || "") +
            " " +
            (c.tipe || "") +
            " " +
            (c.kontak || "") +
            " " +
            (c.catatan || "");
          return text.toLowerCase().includes(filter.toLowerCase());
        });

        const todayStr = new Date().toLocaleDateString("id-ID", {
          day: "2-digit",
          month: "long",
          year: "numeric"
        });

        // ==== MAIN UI (NO PRINT) ====
        const mainUi = React.createElement(
          "div",
          { className: "no-print min-h-screen flex flex-col items-center py-8 px-4" },

          // HEADER
          React.createElement(
            "div",
            { className: "w-full max-w-5xl mb-6 flex flex-col gap-2" },
            React.createElement(
              "h1",
              { className: "text-3xl font-bold text-primary-700" },
              "ProFile Manager"
            ),
            React.createElement(
              "p",
              { className: "text-sm text-slate-600" },
              "Kelola data klien (PT / CV / Perorangan) dengan integrasi langsung ke Firestore. Sekaligus cetak tanda terima dan surat jalan berkas."
            )
          ),

          // ALERT
          (error || success) &&
            React.createElement(
              "div",
              { className: "w-full max-w-5xl mb-4 space-y-2" },
              error &&
                React.createElement(
                  "div",
                  {
                    className:
                      "rounded-lg border border-red-200 bg-red-50 px-4 py-2 text-sm text-red-700"
                  },
                  error
                ),
              success &&
                React.createElement(
                  "div",
                  {
                    className:
                      "rounded-lg border border-emerald-200 bg-emerald-50 px-4 py-2 text-sm text-emerald-700"
                  },
                  success
                )
            ),

          // MAIN GRID
          React.createElement(
            "div",
            {
              className:
                "w-full max-w-5xl grid grid-cols-1 md:grid-cols-2 gap-6 items-start"
            },

            // FORM
            React.createElement(
              "div",
              {
                className:
                  "bg-white rounded-2xl shadow-sm border border-slate-100 p-5"
              },
              React.createElement(
                "div",
                { className: "flex items-center justify-between mb-3" },
                React.createElement(
                  "h2",
                  { className: "text-lg font-semibold" },
                  editingId ? "Edit Klien" : "Tambah Klien"
                ),
                editingId &&
                  React.createElement(
                    "button",
                    {
                      type: "button",
                      onClick: () => {
                        resetForm();
                        setSelectedClient(null);
                      },
                      className:
                        "text-xs px-3 py-1 rounded-full border border-slate-200 text-slate-500 hover:bg-slate-50"
                    },
                    "Batal Edit"
                  )
              ),

              React.createElement(
                "form",
                { className: "space-y-3", onSubmit: handleSubmit },

                // NAMA
                React.createElement(
                  "div",
                  { className: "space-y-1" },
                  React.createElement(
                    "label",
                    { className: "text-sm font-medium text-slate-700" },
                    "Nama Klien"
                  ),
                  React.createElement("input", {
                    className:
                      "w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",
                    placeholder: "Contoh: PT Maju Mundur Sejahtera",
                    value: nama,
                    onChange: (e) => setNama(e.target.value)
                  })
                ),

                // TIPE
                React.createElement(
                  "div",
                  { className: "space-y-1" },
                  React.createElement(
                    "label",
                    { className: "text-sm font-medium text-slate-700" },
                    "Tipe Klien"
                  ),
                  React.createElement(
                    "select",
                    {
                      className:
                        "w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",
                      value: tipe,
                      onChange: (e) => setTipe(e.target.value)
                    },
                    React.createElement("option", { value: "PT" }, "PT"),
                    React.createElement("option", { value: "CV" }, "CV"),
                    React.createElement(
                      "option",
                      { value: "Perorangan" },
                      "Perorangan"
                    )
                  )
                ),

                // KONTAK
                React.createElement(
                  "div",
                  { className: "space-y-1" },
                  React.createElement(
                    "label",
                    { className: "text-sm font-medium text-slate-700" },
                    "Kontak (opsional)"
                  ),
                  React.createElement("input", {
                    className:
                      "w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",
                    placeholder: "No HP / email",
                    value: kontak,
                    onChange: (e) => setKontak(e.target.value)
                  })
                ),

                // CATATAN
                React.createElement(
                  "div",
                  { className: "space-y-1" },
                  React.createElement(
                    "label",
                    { className: "text-sm font-medium text-slate-700" },
                    "Catatan (opsional)"
                  ),
                  React.createElement("textarea", {
                    className:
                      "w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",
                    placeholder: "Catatan singkat tentang klien / jenis berkas",
                    rows: 3,
                    value: catatan,
                    onChange: (e) => setCatatan(e.target.value)
                  })
                ),

                // BUTTON
                React.createElement(
                  "button",
                  {
                    type: "submit",
                    disabled: saving,
                    className:
                      "w-full inline-flex items-center justify-center rounded-lg bg-primary-600 text-white text-sm font-medium px-4 py-2 mt-2 hover:bg-primary-700 disabled:opacity-60 disabled:cursor-not-allowed"
                  },
                  saving
                    ? editingId
                      ? "Menyimpan Perubahan..."
                      : "Menyimpan..."
                    : editingId
                    ? "Update Klien"
                    : "Simpan Klien"
                )
              )
            ),

            // LIST + ACTION
            React.createElement(
              "div",
              {
                className:
                  "bg-white rounded-2xl shadow-sm border border-slate-100 p-5 flex flex-col gap-3"
              },

              // FILTER + REFRESH
              React.createElement(
                "div",
                {
                  className:
                    "flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between"
                },
                React.createElement(
                  "div",
                  { className: "flex-1" },
                  React.createElement(
                    "h2",
                    { className: "text-lg font-semibold" },
                    "Daftar Klien"
                  ),
                  React.createElement(
                    "p",
                    { className: "text-xs text-slate-500" },
                    "Klik nama untuk edit, gunakan tombol di kanan untuk cetak atau hapus."
                  )
                ),
                React.createElement(
                  "div",
                  { className: "flex gap-2 mt-2 sm:mt-0" },
                  React.createElement("input", {
                    className:
                      "flex-1 rounded-lg border border-slate-200 px-3 py-1.5 text-xs focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",
                    placeholder: "Cari nama / tipe / kontak",
                    value: filter,
                    onChange: (e) => setFilter(e.target.value)
                  }),
                  React.createElement(
                    "button",
                    {
                      type: "button",
                      onClick: loadClients,
                      className:
                        "text-xs px-3 py-1.5 rounded-lg border border-slate-200 text-slate-600 hover:bg-slate-50 whitespace-nowrap"
                    },
                    "Refresh"
                  )
                )
              ),

              // LIST CONTENT
              loading
                ? React.createElement(
                    "p",
                    { className: "text-sm text-slate-500" },
                    "Memuat data..."
                  )
                : filteredClients.length === 0
                ? React.createElement(
                    "p",
                    { className: "text-sm text-slate-500" },
                    "Tidak ada data klien."
                  )
                : React.createElement(
                    "ul",
                    { className: "space-y-2 max-h-80 overflow-auto pr-1" },
                    filteredClients.map((client) =>
                      React.createElement(
                        "li",
                        {
                          key: client.id,
                          className:
                            "border border-slate-100 rounded-lg px-3 py-2 text-sm flex flex-col gap-1"
                        },
                        React.createElement(
                          "div",
                          {
                            className:
                              "flex items-start justify-between gap-2"
                          },
                          // NAMA (EDIT)
                          React.createElement(
                            "button",
                            {
                              type: "button",
                              onClick: () => handleEdit(client),
                              className:
                                "text-left flex-1 hover:text-primary-700"
                            },
                            React.createElement(
                              "div",
                              { className: "font-medium text-slate-800" },
                              client.nama || "-"
                            ),
                            React.createElement(
                              "div",
                              { className: "text-[11px] text-slate-500" },
                              client.tipe || "-"
                            ),
                            client.kontak &&
                              React.createElement(
                                "div",
                                {
                                  className:
                                    "text-[11px] text-slate-500 mt-0.5"
                                },
                                client.kontak
                              ),
                            client.catatan &&
                              React.createElement(
                                "div",
                                {
                                  className:
                                    "text-[11px] text-slate-400 mt-0.5"
                                },
                                client.catatan
                              )
                          ),

                          // ACTION BUTTONS
                          React.createElement(
                            "div",
                            {
                              className:
                                "flex flex-col items-end gap-1 text-[11px]"
                            },
                            React.createElement(
                              "button",
                              {
                                type: "button",
                                onClick: () => handlePrint("tanda", client),
                                className:
                                  "px-2 py-1 rounded-md border border-slate-200 text-slate-600 hover:bg-slate-50"
                              },
                              "Tanda Terima"
                            ),
                            React.createElement(
                              "button",
                              {
                                type: "button",
                                onClick: () => handlePrint("surat", client),
                                className:
                                  "px-2 py-1 rounded-md border border-slate-200 text-slate-600 hover:bg-slate-50"
                              },
                              "Surat Jalan"
                            ),
                            React.createElement(
                              "button",
                              {
                                type: "button",
                                onClick: () => handleDelete(client.id),
                                disabled: deletingId === client.id,
                                className:
                                  "px-2 py-1 rounded-md border border-red-200 text-red-600 hover:bg-red-50 disabled:opacity-60 disabled:cursor-not-allowed"
                              },
                              deletingId === client.id ? "Hapus..." : "Hapus"
                            )
                          )
                        )
                      )
                    )
                  )
            )
          )
        );

        // ==== PRINT TEMPLATE ====
        let titlePrint = "";
        if (printType === "tanda") titlePrint = "TANDA TERIMA BERKAS";
        if (printType === "surat") titlePrint = "SURAT JALAN BERKAS";

        const printUi =
          printType && selectedClient
            ? React.createElement(
                "div",
                {
                  className:
                    "print-only min-h-screen px-4 py-6 flex justify-center"
                },
                React.createElement(
                  "div",
                  { className: "w-full max-w-2xl text-slate-900" },
                  React.createElement(
                    "div",
                    { className: "text-center mb-6" },
                    React.createElement(
                      "h1",
                      {
                        className:
                          "text-xl font-bold tracking-wide border-b pb-2 mb-2"
                      },
                      titlePrint
                    ),
                    React.createElement(
                      "p",
                      { className: "text-xs" },
                      "Tanggal cetak: ",
                      todayStr
                    )
                  ),

                  React.createElement(
                    "div",
                    { className: "text-sm mb-4" },
                    React.createElement(
                      "table",
                      { className: "w-full text-sm" },
                      React.createElement(
                        "tbody",
                        null,
                        React.createElement(
                          "tr",
                          null,
                          React.createElement(
                            "td",
                            { className: "align-top w-32 pb-1" },
                            "Nama Klien"
                          ),
                          React.createElement(
                            "td",
                            { className: "align-top pb-1" },
                            ": ",
                            selectedClient.nama || "-"
                          )
                        ),
                        React.createElement(
                          "tr",
                          null,
                          React.createElement(
                            "td",
                            { className: "align-top pb-1" },
                            "Tipe"
                          ),
                          React.createElement(
                            "td",
                            { className: "align-top pb-1" },
                            ": ",
                            selectedClient.tipe || "-"
                          )
                        ),
                        React.createElement(
                          "tr",
                          null,
                          React.createElement(
                            "td",
                            { className: "align-top pb-1" },
                            "Kontak"
                          ),
                          React.createElement(
                            "td",
                            { className: "align-top pb-1" },
                            ": ",
                            selectedClient.kontak || "-"
                          )
                        ),
                        React.createElement(
                          "tr",
                          null,
                          React.createElement(
                            "td",
                            { className: "align-top pb-1" },
                            "Catatan"
                          ),
                          React.createElement(
                            "td",
                            { className: "align-top pb-1" },
                            ": ",
                            selectedClient.catatan || "-"
                          )
                        )
                      )
                    )
                  ),

                  React.createElement(
                    "p",
                    { className: "text-sm mb-6" },
                    printType === "tanda"
                      ? "Dengan ini kami menyatakan telah menerima berkas dari klien dengan data sebagaimana tercantum di atas untuk diproses lebih lanjut."
                      : "Dengan ini kami menyatakan telah menyerahkan / mengirimkan berkas kepada klien dengan data sebagaimana tercantum di atas."
                  ),

                  React.createElement(
                    "div",
                    {
                      className:
                        "flex justify-between text-sm mt-8 pt-8 border-t"
                    },
                    React.createElement(
                      "div",
                      { className: "w-1/2 pr-4" },
                      React.createElement("p", null, "Pihak Klien,"),
                      React.createElement("div", {
                        className: "h-12"
                      }),
                      React.createElement(
                        "p",
                        { className: "border-t border-slate-400 inline-block px-4 pt-1" },
                        selectedClient.nama || "________________"
                      )
                    ),
                    React.createElement(
                      "div",
                      { className: "w-1/2 pl-4 text-right" },
                      React.createElement(
                        "p",
                        null,
                        "Petugas,"
                      ),
                      React.createElement("div", {
                        className: "h-12"
                      }),
                      React.createElement(
                        "p",
                        { className: "border-t border-slate-400 inline-block px-4 pt-1" },
                        "________________"
                      )
                    )
                  )
                )
              )
            : React.createElement("div", { className: "print-only" });

        return React.createElement(
          "div",
          null,
          mainUi,
          printUi
        );
      }

      const root = createRoot(document.getElementById("root"));
      root.render(React.createElement(App));
    </script>
  </body>
</html>
